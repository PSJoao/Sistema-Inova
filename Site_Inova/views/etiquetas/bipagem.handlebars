{{! views/etiquetas/bipagem.handlebars }}
<link rel="stylesheet" href="/public/styles/etiquetasBipagem.css">

<div class="content-card">
    
    {{! Cabeçalho com contadores (inalterado) }}
    <div class="bipagem-header">
        <h1 class="page-title">{{title}}</h1>
        <div class="bipagem-stats">
            <div>
                <span class="stat-label">Produtos:</span>
                <span class="stat-value" id="statProdutosCompletos">0</span>
            </div>
            <div>
                <span class="stat-label">Estruturas:</span>
                <span class="stat-value" id="statEstruturasBipadas">0</span>
            </div>
            <div>
                <span class="stat-label">Palete Atual:</span>
                <span class="stat-value" id="statPaleteAtual">1</span>
            </div>
        </div>
    </div>

    <div style="text-align: center;">
        <div class="d-flex align-items-center justify-content-between mb-3 p-2 bg-light rounded border mx-3">
            <div class="custom-control custom-switch">
                <input type="checkbox" class="custom-control-input" id="palletCounterCheckbox" checked>
                <label class="custom-control-label font-weight-bold text-dark" for="palletCounterCheckbox" style="cursor: pointer; user-select: none;">
                    <i class="fas fa-history text-primary"></i> Contador de Paletes
                </label>
            </div>
            <small class="text-muted d-none d-sm-block">
                <i class="fas fa-info-circle"></i> Apenas desligue-o se for realmente necessário.
            </small>
        </div>
    </div>

    {{! Botões de Ação Principais (inalterado) }}
    <div class="bipagem-actions">
        <button type="button" class="btn btn-warning ml-2" id="bipagemResetBtn" title="Zerar lista e voltar contador para 1">
            <i class="fas fa-trash-restore"></i> Resetar Listagem
        </button>
        <button type="button" class="btn btn-accent" id="bipagemAddPalletBtn">
            <i class="fas fa-pallet"></i> Adicionar Palete
        </button>
        <button type="button" class="btn btn-accent" id="bipagemFinalizeBtn">
            <i class="fas fa-check-circle"></i> Finalizar Bipagem
        </button>
    </div>

    {{! Nova Área para Bipagem Atual }}
    <div class="bipagem-current-scan">
        <div class="current-scan-header">
            <h5>Bipagem Atual</h5>
            <div class="current-scan-actions">
                <button type="button" class="btn btn-danger btn-sm" id="bipagemClearCurrentBtn" title="Limpar Bipagem Atual">
                    <i class="fas fa-times"></i> Limpar
                </button>
                <button type="button" class="btn btn-danger btn-sm" id="bipagemCancelarKitBtn" title="Cancelar Montagem do Kit" style="display: none;">
                     <i class="fas fa-ban"></i> Cancelar Kit
                </button>
                {{! Botão Montar/Fechar Kit }}
                <button type="button" class="btn btn-success" id="bipagemMontarKitBtn">
                    <i class="fas fa-box-check"></i> <span>Montar Kit</span>
                </button>
            </div>
        </div>
        <ul id="currentScanList" class="current-scan-list">
            {{! Bips atuais entram aqui }}
            <li class="current-scan-placeholder">Bipe as estruturas deste produto...</li>
        </ul>
    </div>
    {{! Lista de itens bipados (agora são produtos fechados) }}
    <div class="bipagem-list" id="bipagemListContainer">
        {{! Itens serão adicionados dinamicamente pelo JS }}
        <div class="bipagem-placeholder">
            <i class="fas fa-barcode-read"></i>
            <p>Aguardando produtos fechados...</p>
        </div>
    </div>

    {{! Footer fixo com o input de bipagem (inalterado) }}
    <div class="bipagem-footer">
        <div class="form-group">
            <i class="fas fa-barcode-scan input-icon"></i>
            <input type="text" class="form-control" id="bipagemInput" placeholder="Bipar SKU ou EAN da estrutura..." autocomplete="off">
        </div>
    </div>
</div>

{{#section "scripts"}}
    <script src="/public/scripts/etiquetasBipagemManager.js"></script>
{{/section}}