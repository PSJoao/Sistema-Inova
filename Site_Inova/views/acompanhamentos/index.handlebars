{{! ✍️ /views/acompanhamentos/index.hbs (VERSÃO COM CORREÇÕES FINAIS) }}

{{#section "head"}}
    <link href="/public/styles/acompanhamento.css" rel="stylesheet">
{{/section}}

<div class="content-card">
    <div class="page-header-actions">
        <h1 class="page-title">{{title}}</h1>
        <div class="action-buttons">
            <a href="/acompanhamento/pedidos/upload-reports" class="btn btn-outline-accent"><i class="fas fa-upload"></i> Upload de Relatórios</a>
            <a href="/acompanhamento/pedidos/download" class="btn btn-success-alt"><i class="fas fa-file-excel"></i> Baixar Relatório Completo</a>
        </div>
    </div>

    {{!-- [ALTERADO] Controles do topo da tabela agora com Itens por Página e Busca --}}
    <div class="acmp-top-bar">
        <div class="acmp-items-per-page">
            <label for="acmp-page-length">Itens por página:</label>
            <select id="acmp-page-length" class="form-control form-control-sm">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>
        <div class="acmp-search-container">
            <label for="acmp-search-input">Buscar:</label>
            <input type="search" id="acmp-search-input" class="form-control form-control-sm" placeholder="Digite para buscar...">
        </div>
    </div>

    {{!-- Filtros de Data e Plataforma --}}
    <div class="acmp-filters-bar">
        <div class="acmp-filter-group">
            <label for="acmp-min-date">De:</label>
            <input type="date" id="acmp-min-date" class="form-control form-control-sm">
        </div>
        <div class="acmp-filter-group">
            <label for="acmp-max-date">Até:</label>
            <input type="date" id="acmp-max-date" class="form-control form-control-sm">
        </div>
        <div class="acmp-filter-group">
            <label for="acmp-platform-filter">Plataforma:</label>
            <select id="acmp-platform-filter" class="form-control form-control-sm">
                <option value="">Todas</option>
                {{#each plataformas}}
                    <option value="{{this.plataforma}}">{{this.plataforma}}</option>
                {{/each}}
            </select>
        </div>
    </div>

    {{!-- Barras de Seleção e Ação --}}
    <div id="acmp-selection-info-bar" class="acmp-selection-status-bar" style="display: none;">
        <div>
            <span id="acmp-selection-count">0</span> pedido(s) selecionado(s)
        </div>
        <button id="acmp-clear-selection-btn" class="btn-icon" title="Limpar seleção"><i class="fas fa-times"></i></button>
    </div>
    <div id="acmp-bulk-action-container" class="acmp-bulk-actions-bar" style="display: none;">
        {{!-- Conteúdo das ações em massa permanece o mesmo --}}
        <div class="acmp-filter-group acmp-bulk-actions-group">
            <label for="acmp-comissao-percentual-input">Aplicar Comissão em Massa (%):</label>
            <div class="input-group">
                <input type="number" id="acmp-comissao-percentual-input" class="form-control form-control-sm" placeholder="Ex: 15" min="0" max="100" step="0.01">
                <button id="acmp-btn-apply-bulk-comissao" class="btn btn-sm btn-accent">Aplicar</button>
            </div>
        </div>
    </div>

    {{!-- Tabela e Overlay --}}
    <div class="acmp-table-wrapper">
        <div id="acmp-loading-overlay" class="acmp-loading-overlay" style="display: none;">
            <div class="acmp-spinner"></div>
            <span>Carregando...</span>
        </div>
        <table id="acmp-pedidos-table" class="acmp-table">
            <thead>
                {{!-- Conteúdo do cabeçalho permanece o mesmo --}}
                <tr>
                    <th class="acmp-col-checkbox"><input type="checkbox" id="acmp-select-all-checkbox"></th>
                    <th class="acmp-sortable" data-column="data_aprovacao" data-direction="desc">Data Aprov. <i class="fas fa-sort"></i></th>
                    <th class="acmp-sortable" data-column="plataforma">Plataforma <i class="fas fa-sort"></i></th>
                    <th class="acmp-sortable" data-column="numero_pedido">Nº Pedido <i class="fas fa-sort"></i></th>
                    <th class="acmp-sortable" data-column="numero_nfe">Nº NFe <i class="fas fa-sort"></i></th>
                    <th class="acmp-sortable" data-column="nome_cliente">Cliente <i class="fas fa-sort"></i></th>
                    <th>UF</th>
                    <th>Produto</th>
                    <th>SKU</th>
                    <th class="acmp-sortable acmp-col-currency" data-column="valor_produto">Valor <i class="fas fa-sort"></i></th>
                    <th class="acmp-col-currency">Frete</th>
                    <th class="acmp-col-currency">Desconto</th>
                    <th class="acmp-col-currency">Custo</th>
                    <th class="acmp-col-currency">Comissão</th>
                    <th>% Comissão</th>
                    <th class="acmp-col-acoes">Ações</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    {{!-- Controles de Paginação (agora sem o "Itens por Página") --}}
    <div class="acmp-pagination-controls">
        <div class="acmp-pagination-info">
            <span id="acmp-pagination-summary"></span>
        </div>
        <nav id="acmp-pagination-nav" class="acmp-pagination-nav"></nav>
    </div>
</div>

{{#section "scripts"}}
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="/public/scripts/modal.js"></script>
    <script src="/public/scripts/pedidosManager.js"></script>
{{/section}}